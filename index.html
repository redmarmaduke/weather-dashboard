<!DOCTYPE html>
<html lang="us">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <title>Weather Dashboard</title>
</head>

<body>
    <div class="row">
        <div class="col-2 bg-light pl-4 vh-100">
            <form class="pb-4">
                <h5><label for="input_location" class="display-5">Search for a City:</label></h5>
                <div class="input-group">
                    <input id="input_location" type="text" class="form-control" placeholder="Location">
                    <button id="submit_location" type="button" class="btn btn-default bg-primary input-group-append">
                        <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" class="img-fluid" width="25px"
                            height="25px" viewBox="0 0 172 172" style=" fill:#000000;">
                            <g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt"
                                stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0"
                                font-family="none" font-weight="none" font-size="none" text-anchor="none"
                                style="mix-blend-mode: normal">
                                <path d="M0,172v-172h172v172z" fill="none"></path>
                                <g id="original-icon" fill="#ffffff">
                                    <path
                                        d="M72.24,10.32c-32.33062,0 -58.48,26.14938 -58.48,58.48c0,32.33063 26.14938,58.48 58.48,58.48c11.54281,0 22.22563,-3.38625 31.2825,-9.1375l42.2475,42.2475l14.62,-14.62l-41.71,-41.6025c7.49813,-9.83625 12.04,-22.02406 12.04,-35.3675c0,-32.33062 -26.14937,-58.48 -58.48,-58.48zM72.24,24.08c24.76531,0 44.72,19.95469 44.72,44.72c0,24.76531 -19.95469,44.72 -44.72,44.72c-24.76531,0 -44.72,-19.95469 -44.72,-44.72c0,-24.76531 19.95469,-44.72 44.72,-44.72z">
                                    </path>
                                </g>
                            </g>
                        </svg> </button>
                </div>
            </form>
            <ul id="location_history" class="list-group">
                <li class="list-group-item">Austin</li>
            </ul>
        </div>
        <div class="col-10 pl-0">
            <div class="jumbotron jumbotron-fluid px-4 border bg-white">
                <h1 class="display-5">
                    <p>Atlanta (8/15/2019)</p><img src="#" />
                </h1>

                <p>Temperature: 90.9 &degF</p>
                <p>Humidity: 41%</p>
                <p>Wind Speed: 4.7 MPH</p>
                <p>UV Index: 9.49</p>
            </div>
            <h2 class="display-5">5-Day Forecast:</h2>
            <div class="d-flex justify-content-start">
                <div class="card mr-4 bg-primary text-white">
                    <div class="card-body">
                        <h5 class="card-title">8/16/2019</h5>
                        <img src="">
                        <p class="card-text">Temp: 86.85 &degF</p>
                        <p class="card-text">Humidity: 4.3%</p>
                    </div>
                </div>
                <div class="card mr-4 bg-primary text-white">
                    <div class="card-body">
                        <h5 class="card-title">8/16/2019</h5>
                        <img src="">
                        <p class="card-text">Temp: 86.85 &degF</p>
                        <p class="card-text">Humidity: 4.3%</p>
                    </div>
                </div>
                <div class="card mr-4 bg-primary text-white">
                    <div class="card-body">
                        <h5 class="card-title">8/16/2019</h5>
                        <img src="">
                        <p class="card-text">Temp: 86.85 &degF</p>
                        <p class="card-text">Humidity: 4.3%</p>
                    </div>
                </div>
                <div class="card  mr-4 bg-primary text-white">
                    <div class="card-body">
                        <h5 class="card-title">8/16/2019</h5>
                        <img src="">
                        <p class="card-text">Temp: 86.85 &degF</p>
                        <p class="card-text">Humidity: 4.3%</p>
                    </div>
                </div>
                <div class="card mr-4 bg-primary text-white">
                    <div class="card-body">
                        <h5 class="card-title">8/16/2019</h5>
                        <img src="">
                        <p class="card-text">Temp: 86.85 &degF</p>
                        <p class="card-text">Humidity: 4.3%</p>
                    </div>
                </div>

            </div>
            <footer>
                <a href="https://icons8.com/icon/7695/search">Search icon by Icons8</a>
            </footer>
        </div>

        <script src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
        <!--<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
            integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
            crossorigin="anonymous"></script>-->
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
            crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
            crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
        <script>
            function updatePageCurrentWeather(obj) {
                console.log(obj);
            }

            function updatePageForecast(obj) {
                console.log(obj);
            }

            function updatePage(event) {
                var city = $(event.target).text();
                getCurrentWeather(city,updatePageCurrentWeather);
                getForecast(city,updatePageForecast);
            }

            $("#submit_location").click(function(event) {
                var location = $("#input_location").val().trim();
                var li = $("<li>");
                li.html("<li class=\"list-group-item\">"+location+"</li>");
                li.click(updatePage);
                $("#location_history").prepend(li);
            });

            /*
             * getCurrentWeather 
             * 
             * @param{string} city name of city
             *
             * @return{Object}
             *  {
             *    date: ?,
             *    icon_url: ?,
             *    temperature: ?,
             *    humidity: ?,
             *    wind_speed: ?,
             *    uv_index: ?
             *  }
             */
            function getCurrentWeather(city, fn) {
                var url, query, urlQueryComponent, queryUrl;

                url = "https://api.openweathermap.org/data/2.5/weather?";
                query = {
                    q: city,
                    appid: "1ca7ce78e703503786e910c2c8760a17"
                };
                urlQueryComponent = Object.entries(query).map(a => a[0].concat("=", a[1])).join("&");
                queryUrl = url + urlQueryComponent;

                var obj = {
                    date: "",
                    icon_url: "",
                    temperature: "",
                    humidity: "",
                    wind_speed: "",
                    uv_index: ""
                };

                $.ajax({
                    url: queryUrl,
                    method: "GET"
                }).then(function (response) {
                    console.log(response);
                    obj.date = moment(parseInt(response.dt)*1000).format("M/D/YY");
                    obj.icon_url = "";
                    obj.temperature = response.main.temp;
                    obj.humidity = response.main.humidity;
                    obj.wind_speed = response.wind.speed;
                    obj.icon_url = "http://openweathermap.org/img/wn/" + response.weather[0].icon + "@" + response.cod + ".png";

                    url = "https://api.openweathermap.org/data/2.5/uvi/history?";
                    query = {
                        lat: response.coord.lat,
                        lon: response.coord.lon,
                        start: response.dt,
                        end: response.dt,
                        appid: "1ca7ce78e703503786e910c2c8760a17"
                    };
                    urlQueryComponent = Object.entries(query).map(a => a[0].concat("=", a[1])).join("&");
                    queryUrl = url + urlQueryComponent;
                    $.ajax({
                        url: queryUrl,
                        method: "GET"
                    }).then(function (response) {
                        console.log(response);
                        obj.uv_index = response[0].value;
                        fn(obj);
                    });

                });
            }

            function getForecast(city, fn) {
                var url, query, urlQueryComponent, queryUrl;

                url = "http://api.openweathermap.org/data/2.5/forecast/forecast?";
                query = {
                    q: city,
                    units: "imperial",
                    cnt: 5,
                    appid: "1ca7ce78e703503786e910c2c8760a17"
                };
                urlQueryComponent = Object.entries(query).map(a => a[0].concat("=", a[1])).join("&");
                queryUrl = url + urlQueryComponent;

                var obj = [];

                $.ajax({
                    url: queryUrl,
                    method: "GET"
                }).then(function (response) {
                    for (var i = 0; i < response.list.length; ++i) {
                        obj.push({
                            date: moment(parseInt(response.list[i].dt)*1000).format("M/D/YY"),
                            icon_url: "http://openweathermap.org/img/wn/" + response.list[i].weather[0].icon + "@" + response.cod + ".png",
                            temperature: response.list[i].main.temp,
                            humidity: response.list[i].main.humidity
                        });
                    }
                    fn(obj);
                });
            }

            /*
            console.log(getCurrentWeather("Austin", function (obj) {
                console.log(obj);
            }));

            console.log(getForecast("Austin", function(obj) {
                console.log(obj);
            }));
            */
        </script>
</body>

</html>